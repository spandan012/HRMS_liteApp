<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HRMS Lite - Admin Console</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap');

    :root {
      --bg: #f4f5f7;
      --card: #ffffff;
      --ink: #17212b;
      --muted: #667085;
      --brand: #1a7f5a;
      --brand-dark: #0f5c40;
      --accent: #e7f3ee;
      --danger: #c0352b;
      --warning: #f6b04c;
      --border: #e3e7ee;
      --shadow: 0 12px 40px rgba(20, 33, 51, 0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Manrope', sans-serif;
      background: radial-gradient(circle at top, #eef6f2 0%, #f4f5f7 45%, #f2f4f7 100%);
      color: var(--ink);
      min-height: 100vh;
    }

    .page {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }

    .sidebar {
      background: #111c1a;
      color: #eaf4f0;
      padding: 32px 24px;
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .brand {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-badge {
      width: 38px;
      height: 38px;
      background: linear-gradient(135deg, #2f9e74, #7ce0b4);
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-weight: 700;
      color: #0d1b16;
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .nav button {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: inherit;
      padding: 12px 14px;
      border-radius: 12px;
      text-align: left;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .nav button.active,
    .nav button:hover {
      background: rgba(122, 224, 180, 0.18);
      border-color: rgba(122, 224, 180, 0.4);
    }

    .sidebar-footer {
      margin-top: auto;
      font-size: 0.85rem;
      color: rgba(234, 244, 240, 0.7);
    }

    main {
      padding: 32px 40px 56px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 28px;
    }

    .topbar h1 {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .pill {
      background: var(--accent);
      color: var(--brand-dark);
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .grid {
      display: grid;
      gap: 24px;
    }

    .grid-2 {
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .card h2 {
      font-size: 1.2rem;
      margin-bottom: 12px;
    }

    .card p {
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 16px;
    }

    .form {
      display: grid;
      gap: 14px;
    }

    label {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
    }

    input, select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 0.95rem;
      background: #f9fafb;
    }

    input:focus, select:focus {
      outline: 2px solid rgba(26, 127, 90, 0.25);
      border-color: var(--brand);
      background: #ffffff;
    }

    .button {
      padding: 12px 18px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .button.primary {
      background: var(--brand);
      color: #ffffff;
    }

    .button.primary:hover {
      background: var(--brand-dark);
    }

    .button.ghost {
      background: #f3f4f7;
      color: var(--ink);
      border: 1px solid var(--border);
    }

    .button.danger {
      background: rgba(192, 53, 43, 0.12);
      color: var(--danger);
      border: 1px solid rgba(192, 53, 43, 0.2);
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    .table th, .table td {
      text-align: left;
      padding: 12px 10px;
      border-bottom: 1px solid var(--border);
    }

    .table th {
      color: var(--muted);
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .table td.actions {
      text-align: right;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      display: inline-block;
    }

    .badge.present {
      background: rgba(26, 127, 90, 0.12);
      color: var(--brand-dark);
    }

    .badge.absent {
      background: rgba(192, 53, 43, 0.12);
      color: var(--danger);
    }

    .state {
      padding: 16px;
      border-radius: 12px;
      background: #f7f8fa;
      color: var(--muted);
      border: 1px dashed var(--border);
      font-size: 0.95rem;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: #0f1b17;
      color: #ffffff;
      padding: 12px 16px;
      border-radius: 12px;
      opacity: 0;
      transform: translateY(8px);
      transition: all 0.2s ease;
      box-shadow: var(--shadow);
      font-size: 0.9rem;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .hidden { display: none; }

    @media (max-width: 980px) {
      .page { grid-template-columns: 1fr; }
      .sidebar { flex-direction: row; align-items: center; justify-content: space-between; }
      .nav { flex-direction: row; }
      main { padding: 24px; }
    }

    @media (max-width: 720px) {
      .sidebar { flex-wrap: wrap; gap: 16px; }
      .nav { width: 100%; flex-wrap: wrap; }
      .topbar { flex-direction: column; align-items: flex-start; gap: 12px; }
      .table th, .table td { font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <div class="page">
    <aside class="sidebar">
      <div class="brand">
        <span class="brand-badge">HR</span>
        HRMS Lite
      </div>
      <nav class="nav">
        <button class="active" data-tab="employees">Employee Management</button>
        <button data-tab="attendance">Attendance Tracking</button>
      </nav>
      <div class="sidebar-footer">
        Internal Admin Console · Single Admin
      </div>
    </aside>

    <main>
      <div class="topbar">
        <h1>Admin Dashboard</h1>
        <span class="pill">Production-ready HR essentials</span>
      </div>

      <section class="grid grid-2" style="margin-bottom: 24px;">
        <div class="card">
          <h2>Quick Summary</h2>
          <p>High-level totals across your workforce.</p>
          <div class="grid" style="gap: 12px;">
            <div class="state" id="summary-state">Loading summary...</div>
            <div class="grid hidden" id="summary-cards" style="grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px;">
              <div class="card" style="box-shadow:none; border:1px solid var(--border); padding:16px;">
                <div style="font-size:0.85rem; color:var(--muted);">Employees</div>
                <div id="summary-employees" style="font-size:1.6rem; font-weight:700;">0</div>
              </div>
              <div class="card" style="box-shadow:none; border:1px solid var(--border); padding:16px;">
                <div style="font-size:0.85rem; color:var(--muted);">Attendance Records</div>
                <div id="summary-attendance" style="font-size:1.6rem; font-weight:700;">0</div>
              </div>
              <div class="card" style="box-shadow:none; border:1px solid var(--border); padding:16px;">
                <div style="font-size:0.85rem; color:var(--muted);">Total Present</div>
                <div id="summary-present" style="font-size:1.6rem; font-weight:700;">0</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Present Days by Employee</h2>
          <p>Track consistency across the team.</p>
          <div id="present-state" class="state">Loading summary...</div>
          <table class="table hidden" id="present-table">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Present Days</th>
              </tr>
            </thead>
            <tbody id="present-body"></tbody>
          </table>
        </div>
      </section>

      <section id="employees" class="tab">
        <div class="grid grid-2">
          <div class="card">
            <h2>Add Employee</h2>
            <p>Create a new employee profile. Employee ID and email must be unique.</p>
            <form id="employee-form" class="form">
              <div>
                <label for="employeeId">Employee ID</label>
                <input id="employeeId" name="employeeId" placeholder="EMP-001" required />
              </div>
              <div>
                <label for="fullName">Full Name</label>
                <input id="fullName" name="fullName" placeholder="Avery Johnson" required />
              </div>
              <div>
                <label for="email">Email Address</label>
                <input id="email" name="email" type="email" placeholder="avery@company.com" required />
              </div>
              <div>
                <label for="department">Department</label>
                <input id="department" name="department" placeholder="Engineering" required />
              </div>
              <button class="button primary" type="submit">Add Employee</button>
            </form>
          </div>

          <div class="card">
            <h2>Employee Directory</h2>
            <p>All active employees appear here.</p>
            <div id="employee-state" class="state">Loading employees...</div>
            <table class="table hidden" id="employee-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Department</th>
                  <th class="actions">Action</th>
                </tr>
              </thead>
              <tbody id="employee-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="attendance" class="tab hidden">
        <div class="grid grid-2">
          <div class="card">
            <h2>Mark Attendance</h2>
            <p>Record daily attendance for an employee.</p>
            <form id="attendance-form" class="form">
              <div>
                <label for="attendanceEmployee">Employee</label>
                <select id="attendanceEmployee" required></select>
              </div>
              <div>
                <label for="attendanceDate">Date</label>
                <input id="attendanceDate" type="date" required />
              </div>
              <div>
                <label for="attendanceStatus">Status</label>
                <select id="attendanceStatus" required>
                  <option value="Present">Present</option>
                  <option value="Absent">Absent</option>
                </select>
              </div>
              <button class="button primary" type="submit">Save Attendance</button>
            </form>
          </div>

          <div class="card">
            <h2>Attendance Records</h2>
            <p>Review attendance history by employee.</p>
            <div class="form" style="margin-bottom: 16px;">
              <div>
                <label for="attendanceViewEmployee">Select Employee</label>
                <select id="attendanceViewEmployee"></select>
              </div>
              <div>
                <label for="filterStart">Start Date</label>
                <input id="filterStart" type="date" />
              </div>
              <div>
                <label for="filterEnd">End Date</label>
                <input id="filterEnd" type="date" />
              </div>
              <button class="button ghost" id="refresh-attendance" type="button">Refresh Records</button>
            </div>
            <div id="attendance-state" class="state">Select an employee to view attendance.</div>
            <table class="table hidden" id="attendance-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="attendance-body"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="toast" class="toast"></div>
  <script>
    const API_BASE = 'http://localhost:3000/api';

    const employeeState = document.getElementById('employee-state');
    const employeeTable = document.getElementById('employee-table');
    const employeeBody = document.getElementById('employee-body');
    const attendanceState = document.getElementById('attendance-state');
    const attendanceTable = document.getElementById('attendance-table');
    const attendanceBody = document.getElementById('attendance-body');
    const attendanceEmployee = document.getElementById('attendanceEmployee');
    const attendanceViewEmployee = document.getElementById('attendanceViewEmployee');
    const filterStart = document.getElementById('filterStart');
    const filterEnd = document.getElementById('filterEnd');
    const toast = document.getElementById('toast');
    const summaryState = document.getElementById('summary-state');
    const summaryCards = document.getElementById('summary-cards');
    const summaryEmployees = document.getElementById('summary-employees');
    const summaryAttendance = document.getElementById('summary-attendance');
    const summaryPresent = document.getElementById('summary-present');
    const presentState = document.getElementById('present-state');
    const presentTable = document.getElementById('present-table');
    const presentBody = document.getElementById('present-body');

    const showToast = (message, isError = false) => {
      toast.textContent = message;
      toast.style.background = isError ? '#5b1f1a' : '#0f1b17';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2400);
    };

    const setState = (stateEl, tableEl, message) => {
      stateEl.textContent = message;
      stateEl.classList.remove('hidden');
      tableEl.classList.add('hidden');
    };

    const showTable = (stateEl, tableEl) => {
      stateEl.classList.add('hidden');
      tableEl.classList.remove('hidden');
    };
    const renderEmployees = (employees) => {
      employeeBody.innerHTML = '';

      if (!employees.length) {
        setState(employeeState, employeeTable, 'No employees yet. Add your first employee.');
        updateEmployeeSelects([]);
        return;
      }

      employees.forEach((employee) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${employee.employee_id}</td>
          <td>${employee.full_name}</td>
          <td>${employee.email}</td>
          <td>${employee.department}</td>
          <td class="actions">
            <button class="button danger" data-delete="${employee.employee_id}">Delete</button>
          </td>
        `;
        employeeBody.appendChild(row);
      });

      showTable(employeeState, employeeTable);
      updateEmployeeSelects(employees);
    };

    const updateEmployeeSelects = (employees) => {
      const options = employees.map((employee) =>
        `<option value="${employee.employee_id}">${employee.full_name} · ${employee.employee_id}</option>`
      );

      const emptyOption = '<option value="">Select employee</option>';
      attendanceEmployee.innerHTML = employees.length ? options.join('') : emptyOption;
      attendanceViewEmployee.innerHTML = employees.length ? options.join('') : emptyOption;

      if (!employees.length) {
        setState(attendanceState, attendanceTable, 'Add employees to start tracking attendance.');
      }
    };

    const renderAttendance = (records) => {
      attendanceBody.innerHTML = '';

      if (!records.length) {
        setState(attendanceState, attendanceTable, 'No attendance records for this employee.');
        return;
      }

      records.forEach((record) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${record.date}</td>
          <td><span class="badge ${record.status === 'Present' ? 'present' : 'absent'}">${record.status}</span></td>
        `;
        attendanceBody.appendChild(row);
      });

      showTable(attendanceState, attendanceTable);
    };

    const renderSummary = (summary) => {
      summaryEmployees.textContent = summary.totals.employees;
      summaryAttendance.textContent = summary.totals.attendance;
      summaryPresent.textContent = summary.totals.present;
      summaryState.classList.add('hidden');
      summaryCards.classList.remove('hidden');
    };

    const renderPresentDays = (items) => {
      presentBody.innerHTML = '';

      if (!items.length) {
        setState(presentState, presentTable, 'No attendance data yet.');
        return;
      }

      items.forEach((item) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.full_name} · ${item.employee_id}</td>
          <td>${item.present_days}</td>
        `;
        presentBody.appendChild(row);
      });

      showTable(presentState, presentTable);
    };
    const loadEmployees = async () => {
      setState(employeeState, employeeTable, 'Loading employees...');
      try {
        const response = await fetch(`${API_BASE}/employees`);
        if (!response.ok) throw new Error('Failed to load employees');
        const data = await response.json();
        renderEmployees(data.employees || []);
      } catch (error) {
        setState(employeeState, employeeTable, 'Unable to load employees. Check the server.');
      }
    };

    const loadAttendance = async (employeeId) => {
      if (!employeeId) {
        setState(attendanceState, attendanceTable, 'Select an employee to view attendance.');
        return;
      }

      setState(attendanceState, attendanceTable, 'Loading attendance records...');
      try {
        const params = new URLSearchParams();
        if (filterStart.value) params.append('startDate', filterStart.value);
        if (filterEnd.value) params.append('endDate', filterEnd.value);
        const query = params.toString() ? `?${params.toString()}` : '';
        const response = await fetch(`${API_BASE}/employees/${employeeId}/attendance${query}`);
        const data = await response.json();
        if (!response.ok) throw new Error(data.error || 'Failed to load');
        renderAttendance(data.records || []);
      } catch (error) {
        setState(attendanceState, attendanceTable, 'Unable to load attendance.');
      }
    };

    const loadSummary = async () => {
      summaryState.textContent = 'Loading summary...';
      summaryState.classList.remove('hidden');
      summaryCards.classList.add('hidden');
      setState(presentState, presentTable, 'Loading summary...');

      try {
        const response = await fetch(`${API_BASE}/summary`);
        const data = await response.json();
        if (!response.ok) throw new Error(data.error || 'Failed to load summary');
        renderSummary(data);
        renderPresentDays(data.presentByEmployee || []);
      } catch (error) {
        summaryState.textContent = 'Unable to load summary.';
        setState(presentState, presentTable, 'Unable to load summary.');
      }
    };
    document.getElementById('employee-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const payload = {
        employeeId: document.getElementById('employeeId').value.trim(),
        fullName: document.getElementById('fullName').value.trim(),
        email: document.getElementById('email').value.trim(),
        department: document.getElementById('department').value.trim(),
      };

      try {
        const response = await fetch(`${API_BASE}/employees`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        const data = await response.json();
        if (!response.ok) throw new Error(data.error || 'Failed to add employee');
        event.target.reset();
        showToast('Employee added.');
        await loadEmployees();
        await loadSummary();
      } catch (error) {
        showToast(error.message, true);
      }
    });

    employeeBody.addEventListener('click', async (event) => {
      const button = event.target.closest('button[data-delete]');
      if (!button) return;

      const employeeId = button.getAttribute('data-delete');
      try {
        const response = await fetch(`${API_BASE}/employees/${employeeId}`, { method: 'DELETE' });
        const data = await response.json();
        if (!response.ok) throw new Error(data.error || 'Failed to delete');
        showToast('Employee deleted.');
        await loadEmployees();
        await loadSummary();
      } catch (error) {
        showToast(error.message, true);
      }
    });

    document.getElementById('attendance-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const payload = {
        employeeId: attendanceEmployee.value,
        date: document.getElementById('attendanceDate').value,
        status: document.getElementById('attendanceStatus').value,
      };

      if (!payload.employeeId) {
        showToast('Select an employee first.', true);
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/attendance`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        const data = await response.json();
        if (!response.ok) throw new Error(data.error || 'Failed to record attendance');
        showToast('Attendance recorded.');
        await loadAttendance(payload.employeeId);
        await loadSummary();
      } catch (error) {
        showToast(error.message, true);
      }
    });

    attendanceViewEmployee.addEventListener('change', (event) => {
      loadAttendance(event.target.value);
    });

    document.getElementById('refresh-attendance').addEventListener('click', () => {
      loadAttendance(attendanceViewEmployee.value);
    });

    document.querySelectorAll('.nav button').forEach((btn) => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.nav button').forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');

        const tab = btn.getAttribute('data-tab');
        document.querySelectorAll('.tab').forEach((section) => {
          section.classList.toggle('hidden', section.id !== tab);
        });
      });
    });

    loadEmployees();
    loadSummary();
  </script>
</body>
</html>
